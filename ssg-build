#!/bin/sh

export output="$(mktemp -dp /tmp 'ssg-XXXXX')"
# PATH="$PATH:unnamed-ssg"
indexsep="|"

# # Uncomment if $output is not a temporary directory
# [ -d "$output" ] && rm -r "$output"
# mkdir -p "$output"

# Mics
find -L * -exec mvfiles '{}' +

# RSS
genrss -F"$indexsep" index.db | wraphtml -t template.xml > "$output/rss.xml"

# Index
genindex -F"$indexsep" index.db | wraphtml > "$output/index.html"

echo "Generated Website outputted to $output"

# # Neocities
# find "$output" -type f ! -regex '.*\.asc\|.*\.atom\|.*\.bin\|.*\.css\|.*\.csv\|.*\.dae\|.*\.eot\|.*\.epub\|.*\.geojson\|.*\.gif\|.*\.gltf\|.*\.htm\|.*\.html\|.*\.ico\|.*\.jpeg\|.*\.jpg\|.*\.js\|.*\.json\|.*\.key\|.*\.kml\|.*\.knowl\|.*\.less\|.*\.manifest\|.*\.markdown\|.*\.md\|.*\.mf\|.*\.mid\|.*\.midi\|.*\.mtl\|.*\.obj\|.*\.opml\|.*\.otf\|.*\.pdf\|.*\.pgp\|.*\.png\|.*\.rdf\|.*\.rss\|.*\.sass\|.*\.scss\|.*\.svg\|.*\.text\|.*\.tsv\|.*\.ttf\|.*\.txt\|.*\.webapp\|.*\.webmanifest\|.*\.webp\|.*\.woff\|.*\.woff2\|.*\.xcf\|.*\.xml\|.*\.' -exec mv '{}' '{}.txt' \;
# neocities push "$output"
