#!/usr/bin/awk -f

BEGIN {
	print "<?xml version=\"1.0\" encoding=\"UTF-8\"?>"
	print "<rss version=\"2.0\">"
	print "<channel>"
	printf "<title>%s</title>\n", RSSTitle
	printf "<link>%s</link>\n", WebsiteURL
	if (RSSDescription)
		printf "<description>%s</description>\n", RSSDescription

}

/^#/ { next }
/^$/ { next }

{
	print "<item>"
	"date -R -d " $1 | getline pubDate
	printf "<title>%s</title>\n", $2
	printf "<link>%s</link>\n", $3
	printf "<guid>%s</guid>\n", $3
	printf "<pubDate>%s</pubDate>\n", pubDate
	print "<description><![CDATA["
	if ($4) print $4 "\n"
	if($3 ~ /\.htm[l]?$/) {
		print system("cat " gensub(/^\//, "", "g", $3)) > "/dev/null"
	} else {
		printf "<a href=\"%s\">%s</a>\n", $3, $2
	}
	print "]]></description>"
	print "</item>"
}

END {
	print "</channel>"
	print "</rss>"

}
